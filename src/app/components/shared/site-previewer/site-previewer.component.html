@if (!isOverlayOpen()) {
    <div class="border border-neutral-800 rounded-xl overflow-hidden" style="view-transition-name: site-preview">
        <div class="flex gap-2 border-b border-neutral-800 rounded-t-xl p-4" style="view-transition-name: technologies;">
            <span class="font-semibold text-sm" style="view-transition-name: technologies-title;">Tecnologias usadas:</span>
            <div class="flex items-center divide-x-1 divide-neutral-800 text-xs">
                @if(websites()[currentIndex()].technologies.includes('angular')) {
                    <span class="px-2 text-red-100" [ngStyle]="{'view-transition-name': 'angular'}" @slide>Angular</span>
                }
                @if(websites()[currentIndex()].technologies.includes('tailwind')) {
                    <span class="px-2 text-cyan-100" [ngStyle]="{'view-transition-name': 'tailwind'}" @slide>Tailwind</span>
                }
                @if(websites()[currentIndex()].technologies.includes('html')) {
                    <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'html'}" @slide>HTML</span>
                }
                @if(websites()[currentIndex()].technologies.includes('css')) {
                    <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'css'}" @slide>CSS</span>
                }
                @if(websites()[currentIndex()].technologies.includes('js')) {
                    <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'js'}" @slide>JavaScript</span>
                }
            </div>
        </div>
        <div class="aspect-video overflow-hidden relative group" style="view-transition-name: img-preview">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 flex flex-col items-center opacity-90 
            group-hover:opacity-0 transition-all duration-500 pointer-events-none">
                <h2 class="text-4xl font-semibold"> {{ websites()[currentIndex()].title }} </h2>
                <span>Website</span>
            </div>
            <button class="absolute top-1/2 left-1/13 -translate-y-1/2 bg-neutral-900/15 backdrop-blur rounded-full p-3 border border-neutral-100/10 opacity-20 group-hover:opacity-100
            hover:bg-neutral-900/30 hover:border-neutral-100/30 transition-all z-10"
            style="view-transition-name: left-btn;"
            (click)="previous()">
                <i class="fi fi-rr-angle-small-left flex"></i>
            </button>
            <button class="absolute top-1/2 right-1/13 -translate-y-1/2 bg-neutral-900/15 backdrop-blur rounded-full p-3 border border-neutral-100/10 opacity-20 group-hover:opacity-100
            hover:bg-neutral-900/30 hover:border-neutral-100/30 transition-all z-10"
            style="view-transition-name: right-btn;"
            (click)="next()">
                <i class="fi fi-rr-angle-small-right flex"></i>
            </button>
            <span class="absolute p-4 bottom-1/3 left-1/2 -translate-x-1/2 translate-y-1/2 rounded-full z-10 bg-transparent border border-transparent
            hover:bg-neutral-950/30 transition-all duration-300 ease-out
            group-hover:bg-neutral-950/5 group-hover:opacity-0 group-hover:scale-150 pointer-events-none">
                <img class="w-6 h-6 object-fit object-center" 
                src="./icons/cursor-finger-click.png" alt="Click here button">
            </span>
            <img class="w-full h-full object-cover object-top rounded-b-xl brightness-30 saturate-50 cursor-pointer
            group-hover:brightness-80 group-hover:saturate-100 transition-all duration-300" style="view-transition-name: img"
            [src]="websites()[currentIndex()].imgUrl" alt="" [@fadeTrigger]="websites()[currentIndex()].imgUrl"
            (click)="open()">
        </div>
    </div>
}

<ng-template #overlayTemplate>
    <div class="border border-neutral-800 rounded-t-xl overflow-hidden bg-neutral-950 flex flex-col h-full w-full" style="view-transition-name: site-preview">
        <div class="flex justify-between gap-2 border-b border-neutral-800 rounded-t-xl p-4" style="view-transition-name: technologies;">
            <span></span>
            <div class="flex items-center gap-2">
                <span class="font-semibold text-lg" style="view-transition-name: technologies-title;">Tecnologias usadas:</span>
                <div class="flex items-center divide-x-1 divide-neutral-800">
                    @if(websites()[currentIndex()].technologies.includes('angular')) {
                        <span class="px-2 text-red-100" [ngStyle]="{'view-transition-name': 'angular'}" @slide>Angular</span>
                    }
                    @if(websites()[currentIndex()].technologies.includes('tailwind')) {
                        <span class="px-2 text-cyan-100" [ngStyle]="{'view-transition-name': 'tailwind'}" @slide>Tailwind</span>
                    }
                    @if(websites()[currentIndex()].technologies.includes('html')) {
                        <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'html'}" @slide>HTML</span>
                    }
                    @if(websites()[currentIndex()].technologies.includes('css')) {
                        <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'css'}" @slide>CSS</span>
                    }
                    @if(websites()[currentIndex()].technologies.includes('js')) {
                        <span class="px-2 text-neutral-400" [ngStyle]="{'view-transition-name': 'js'}" @slide>JavaScript</span>
                    }
                </div>
            </div>
            <button class="p-2 text-xl hover:opacity-50 transition-all" (click)="close()">
                <i class="fi fi-rr-cross-small flex"></i>
            </button>
        </div>
        <div style="view-transition-name: img-preview" class="relative group h-full overflow-hidden transition-all duration-300">
            @if(!iframe().loaded) {
                <img class="w-full h-full object-cover object-top absolute top-0 left-0 z-10 brightness-80"
                [src]="websites()[currentIndex()].imgUrl" alt="" style="view-transition-name: img" @fade>
                <div class="absolute z-10 top-1/2 left-1/2 -translate-1/2 min-w-[16px] flex flex-col items-center gap-3 px-6 py-4 bg-neutral-900/30 backdrop-blur rounded-xl" @fade>
                    <h2 class="text-2xl leading-none">Loading website</h2>
                    <div class="custom-loader"></div>
                </div>
            }
            @if(iframe().startLoading) {
                <iframe class="w-full h-full absolute top-0 left-0" #iframeRef
                [src]="sanitizedUrl()" style="view-transition-name: img"
                (load)="setIframeLoaded(true)">
                </iframe>
            }
        </div>
    </div>
</ng-template>